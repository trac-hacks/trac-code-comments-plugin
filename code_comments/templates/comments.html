<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <head>
    <title>Code Comments</title>
    
    <script type="text/javascript" charset="utf-8">/*<![CDATA[*/
        jQuery(function($) {
        	$('#send-to-ticket').click(function(e) {
        	    e.preventDefault();
                var ids = $('table.code-comments input:checked' ).map(function(i, e) {return e.id.replace('checked-', '')}).get();
                if (!ids.length) {
                    alert("Please select comments to include in the ticket.");
                    return;
                }
                window.location = '${href('code-comments', 'create-ticket')}?ids=' + ids.join(',');
        	});            
        });
        jQuery(document).ready(function($){
            $('#list-code-comments').tablesorter({ headers: { 1:{sorter: false}, 6:{sorter: false}, 7:{sorter:false} } });
        });
    /*]]>*/</script>
    
  </head>

  <body>
    <div id="content">
        <h1>Code Comments</h1>
        <button id="send-to-ticket" type="submit">Create ticket with selected</button>
        &nbsp;Filter comments: 
        <form action="${href('code-comments')}" method="GET" style="display: inline;">
            <select id="filter-by-path" name="filter-by-path">
                <option value='' selected="selected">-- All paths --</option>
                <option py:for="path in paths"
                           selected="${current_path_selection == path+'/' or None}"
                           value="$path/" py:content="path"></option>
            </select>
            <select id="filter-by-author" name="filter-by-author">
                <option value='' selected="selected">-- All authors --</option>
                <option py:for="author in authors"
                           selected="${current_author_selection == author or None}"
                           value="$author" py:content="author"></option>
            </select>
            <button id="filter" type="submit" name="filter">Filter comments</button>
        </form>
        <table id="list-code-comments" class="listing code-comments tablesorter">
            <thead>
                <tr class="tarc-columns">
                    <th>ID</th>
                    <th>&nbsp;</th>
                    <th>Author</th>
                    <th>Date</th>
                    <th>Path</th>
                    <th>Text</th>
                    <th>Tickets</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            <py:for each="idx, comment in enumerate(comments)">
                <tr class="${idx % 2 and 'odd' or 'even'}">
                    <td>$comment.id</td>
                    <td class="check"><input type="checkbox" id="checked-$comment.id" /></td>
                    <th>$comment.author</th>
                    <th>${comment.formatted_date()}</th>
                    <td>${comment.path_link_tag()}</td>
                    <td>$comment.html</td>
                    <td>${comment.get_ticket_links()}</td>
                    <td>
                        <form py:if="can_delete" action="${href('code-comments', 'delete')}" method="GET">
                            <input type="hidden" name="id" value="$comment.id" />
                            <input type="submit" name="delete" value="Delete" />
                        </form>
                    </td>
                </tr>
            </py:for>
            </tbody>
        </table>
		<xi:include href="page_index.html" />
    </div>
  </body>
</html>